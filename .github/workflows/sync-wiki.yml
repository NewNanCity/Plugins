name: 同步文档到 Wiki (.wiki.git)

on:
  push:
    branches: [main, master]
    paths:
      - "docs/**"
      - "scripts/prepare-wiki-multi.py"
      - ".github/workflows/sync-wiki.yml"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: publish-wiki
  cancel-in-progress: true

jobs:
  publish-wiki:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 设置 Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: 生成 Wiki 文档
        run: |
          python scripts/prepare-wiki-multi.py

      - name: 发布到 GitHub Wiki
        uses: Andrew-Chen-Wang/github-wiki-action@v5
        with:
          # 明确指定目标仓库（即 https://github.com/NewNanCity/Plugins.wiki.git 对应的主仓库）
          repository: NewNanCity/Plugins
          path: wiki
          # 其余保持默认：使用 ${{ github.token }} 推送到 .wiki.git

      - name: 输出同步结果
        run: |
          echo "✅ Wiki 文档同步完成!"
          echo "🔗 访问 Wiki: https://github.com/${{ github.repository }}/wiki"
