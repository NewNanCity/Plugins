# å›½é™…åŒ–ç³»ç»Ÿ

Core æ¨¡å—æä¾›äº†å®Œæ•´çš„å›½é™…åŒ–ï¼ˆi18nï¼‰æ”¯æŒï¼ŒåŒ…æ‹¬å¤šè¯­è¨€æ–‡ä»¶ç®¡ç†ã€è‡ªåŠ¨è¯­è¨€æ£€æµ‹ã€æ¨¡æ¿å‚æ•°æ›¿æ¢å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### å¤šè¯­è¨€æ”¯æŒ
- **è¯­è¨€æ–‡ä»¶ç®¡ç†** - æ”¯æŒå¤šç§è¯­è¨€çš„ YAML é…ç½®æ–‡ä»¶
- **è‡ªåŠ¨å›é€€** - ä¸»è¯­è¨€ â†’ é»˜è®¤è¯­è¨€ â†’ ç¡¬ç¼–ç æ–‡æœ¬çš„å›é€€æœºåˆ¶
- **åŠ¨æ€åˆ‡æ¢** - è¿è¡Œæ—¶è¯­è¨€é…ç½®é‡è½½æ”¯æŒ

### æ¨¡æ¿ç³»ç»Ÿ
- **å‚æ•°æ›¿æ¢** - ä½¿ç”¨ `{0}` `{1}` ç­‰ StringFormat è¯­æ³•
- **æ¨¡æ¿è¯­æ³•** - ä½¿ç”¨ `<%key%>` æ ¼å¼çš„æ¨¡æ¿å¼•ç”¨
- **ç±»å‹å®‰å…¨** - ç¼–è¯‘æ—¶æ¨¡æ¿æ£€æŸ¥å’Œå‚æ•°éªŒè¯

### ç”Ÿå‘½å‘¨æœŸé›†æˆ
- **è‡ªåŠ¨åˆå§‹åŒ–** - ä¸æ’ä»¶ç”Ÿå‘½å‘¨æœŸæ·±åº¦é›†æˆ
- **é…ç½®é‡è½½** - æ”¯æŒè¯­è¨€é…ç½®çš„çƒ­é‡è½½
- **ç¼“å­˜ç®¡ç†** - æ™ºèƒ½ç¼“å­˜æå‡æ€§èƒ½

## ğŸš€ åŸºç¡€ç”¨æ³•

### è®¾ç½®è¯­è¨€ç®¡ç†å™¨

```kotlin
class MyPlugin : BasePlugin() {
    
    override fun reloadPlugin() {
        try {
            // æ¸…ç†é…ç½®ç¼“å­˜
            configManager.clearCache()
            
            // è®¾ç½®è¯­è¨€ç®¡ç†å™¨
            setupLanguageManager(
                languageFiles = mapOf(
                    Locale.SIMPLIFIED_CHINESE to "lang/zh_CN.yml",
                    Locale.US to "lang/en_US.yml",
                    Locale.JAPAN to "lang/ja_JP.yml"
                ),
                majorLanguage = Locale.SIMPLIFIED_CHINESE,  // ä¸»è¦è¯­è¨€
                defaultLanguage = Locale.US                 // é»˜è®¤å›é€€è¯­è¨€
            )
            
            super.reloadPlugin()
        } catch (e: Exception) {
            logger.error("é…ç½®é‡è½½å¤±è´¥", e)
            throw e
        }
    }
}
```

### è¯­è¨€æ–‡ä»¶ç»“æ„

#### ä¸­æ–‡è¯­è¨€æ–‡ä»¶ (lang/zh_CN.yml)
```yaml
# æ¬¢è¿æ¶ˆæ¯
welcome:
  message: "æ¬¢è¿ {0} åŠ å…¥æœåŠ¡å™¨ï¼"
  first_time: "è¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡åŠ å…¥æœåŠ¡å™¨"
  returning: "æ¬¢è¿å›æ¥ï¼Œ{0}ï¼ä½ å·²ç»ç¦»çº¿ {1}"

# ç©å®¶ç›¸å…³
player:
  level_info: "ç©å®¶ {0} å½“å‰ç­‰çº§ï¼š{1}"
  not_found: "æ‰¾ä¸åˆ°ç©å®¶ {0}"
  offline: "ç©å®¶ {0} å½“å‰ç¦»çº¿"
  balance: "ä½ çš„ä½™é¢ï¼š{0} é‡‘å¸"

# æ’ä»¶æ¶ˆæ¯
plugin:
  enabled: "æ’ä»¶å·²å¯ç”¨"
  disabled: "æ’ä»¶å·²ç¦ç”¨"
  config:
    reloaded: "é…ç½®é‡è½½æˆåŠŸ"
    reloading: "æ­£åœ¨é‡è½½é…ç½®..."
    reload_failed: "é…ç½®é‡è½½å¤±è´¥"

# é”™è¯¯æ¶ˆæ¯
error:
  no_permission: "ä½ æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ"
  invalid_argument: "æ— æ•ˆçš„å‚æ•°ï¼š{0}"
  command_failed: "å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼š{0}"
  insufficient_funds: "ä½™é¢ä¸è¶³ï¼Œéœ€è¦ {0} é‡‘å¸"

# æˆåŠŸæ¶ˆæ¯
success:
  operation_completed: "æ“ä½œå®Œæˆ"
  payment_received: "æ”¶åˆ°ä»˜æ¬¾ {0} é‡‘å¸"
  item_given: "å·²ç»™äºˆ {0} ä¸ª {1}"

# GUI ç›¸å…³
gui:
  button:
    confirm: "ç¡®è®¤"
    cancel: "å–æ¶ˆ"
    next: "ä¸‹ä¸€é¡µ"
    previous: "ä¸Šä¸€é¡µ"
    close: "å…³é—­"
  title:
    main_menu: "ä¸»èœå•"
    settings: "è®¾ç½®"
    player_info: "ç©å®¶ä¿¡æ¯"
```

#### è‹±æ–‡è¯­è¨€æ–‡ä»¶ (lang/en_US.yml)
```yaml
# Welcome messages
welcome:
  message: "Welcome {0} to the server!"
  first_time: "This is your first time joining the server"
  returning: "Welcome back, {0}! You were offline for {1}"

# Player related
player:
  level_info: "Player {0} current level: {1}"
  not_found: "Player {0} not found"
  offline: "Player {0} is currently offline"
  balance: "Your balance: {0} coins"

# Plugin messages
plugin:
  enabled: "Plugin enabled"
  disabled: "Plugin disabled"
  config:
    reloaded: "Configuration reloaded successfully"
    reloading: "Reloading configuration..."
    reload_failed: "Configuration reload failed"

# Error messages
error:
  no_permission: "You don't have permission to perform this action"
  invalid_argument: "Invalid argument: {0}"
  command_failed: "Command execution failed: {0}"
  insufficient_funds: "Insufficient funds, need {0} coins"

# Success messages
success:
  operation_completed: "Operation completed"
  payment_received: "Payment received: {0} coins"
  item_given: "Given {0} {1}"

# GUI related
gui:
  button:
    confirm: "Confirm"
    cancel: "Cancel"
    next: "Next Page"
    previous: "Previous Page"
    close: "Close"
  title:
    main_menu: "Main Menu"
    settings: "Settings"
    player_info: "Player Information"
```

## ğŸ’¬ ä½¿ç”¨å›½é™…åŒ–æ¶ˆæ¯

### åœ¨æ’ä»¶ä¸­ä½¿ç”¨

```kotlin
class MyPlugin : BasePlugin() {
    
    override fun onPluginEnable() {
        // âœ… è¯­è¨€è®¾ç½®å‰ä½¿ç”¨è‹±æ–‡æ—¥å¿—
        logger.info("MyPlugin enabling...")
        
        // æ³¨å†Œä¸å¯é‡è½½åŠŸèƒ½
        registerCommands()
        registerEventListeners()
        
        // è°ƒç”¨é‡è½½æ–¹æ³•ï¼ˆä¼šè®¾ç½®è¯­è¨€ç®¡ç†å™¨ï¼‰
        reloadPlugin()
        
        // âœ… è¯­è¨€è®¾ç½®åå¯ä»¥ä½¿ç”¨ i18n æ¨¡æ¿
        logger.info("<%plugin.enabled%>")
    }
    
    private fun sendWelcomeMessage(player: Player) {
        // åŸºç¡€å›½é™…åŒ–æ¶ˆæ¯
        messager.printf(player, "<%welcome.message%>", player.name)
        
        // å¸¦å‚æ•°çš„å›½é™…åŒ–æ¶ˆæ¯
        val level = getPlayerLevel(player)
        messager.printf(player, "<%player.level_info%>", player.name, level)
        
        // æ£€æŸ¥é¦–æ¬¡åŠ å…¥
        if (isFirstTimePlayer(player)) {
            messager.printf(player, "<%welcome.first_time%>")
        }
    }
    
    private fun sendErrorMessage(player: Player, error: String) {
        messager.printf(player, "<%error.command_failed%>", error)
    }
    
    private fun sendSuccessMessage(player: Player, amount: Double) {
        messager.printf(player, "<%success.payment_received%>", amount)
    }
}
```

### åœ¨ BaseModule ä¸­ä½¿ç”¨

```kotlin
class PlayerModule(moduleName: String, val plugin: MyPlugin) : BaseModule(moduleName, plugin) {
    
    override fun onInit() {
        // æ¨¡å—åˆå§‹åŒ–æ¶ˆæ¯
        logger.info("<%plugin.module.initializing%>", moduleName)
        
        // äº‹ä»¶ä¸­ä½¿ç”¨å›½é™…åŒ–
        subscribeEvent<PlayerJoinEvent> { event ->
            val player = event.player
            
            // å‘é€æ¬¢è¿æ¶ˆæ¯
            messager.printf(player, "<%welcome.message%>", player.name)
            
            // æ˜¾ç¤ºç©å®¶ä¿¡æ¯
            val balance = getPlayerBalance(player)
            messager.printf(player, "<%player.balance%>", balance)
        }
        
        subscribeEvent<PlayerQuitEvent> { event ->
            val player = event.player
            val onlineTime = getOnlineTime(player)
            
            // è®°å½•ç©å®¶ç¦»çº¿
            logger.info("<%player.offline%>", player.name)
        }
    }
    
    override fun onReload() {
        // æ¨¡å—é‡è½½æ¶ˆæ¯
        logger.info("<%plugin.module.reloading%>", moduleName)
        
        // é‡è½½å®Œæˆ
        logger.info("<%plugin.module.reloaded%>", moduleName)
    }
    
    private fun handlePlayerCommand(player: Player, command: String) {
        try {
            executePlayerCommand(player, command)
            messager.printf(player, "<%success.operation_completed%>")
        } catch (e: Exception) {
            messager.printf(player, "<%error.command_failed%>", e.message)
            logger.error("<%error.command_failed%>", e.message, e)
        }
    }
}
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### åŠ¨æ€è¯­è¨€åˆ‡æ¢

```kotlin
class MyPlugin : BasePlugin() {
    
    fun switchLanguage(newMajorLanguage: Locale) {
        try {
            logger.info("åˆ‡æ¢è¯­è¨€åˆ°: ${newMajorLanguage.displayName}")
            
            // é‡æ–°è®¾ç½®è¯­è¨€ç®¡ç†å™¨
            setupLanguageManager(
                languageFiles = mapOf(
                    Locale.SIMPLIFIED_CHINESE to "lang/zh_CN.yml",
                    Locale.US to "lang/en_US.yml",
                    Locale.JAPAN to "lang/ja_JP.yml"
                ),
                majorLanguage = newMajorLanguage,
                defaultLanguage = Locale.US
            )
            
            // é€šçŸ¥æ‰€æœ‰åœ¨çº¿ç©å®¶
            server.onlinePlayers.forEach { player ->
                messager.printf(player, "<%plugin.language_changed%>", newMajorLanguage.displayName)
            }
            
            logger.info("<%plugin.language_changed%>", newMajorLanguage.displayName)
            
        } catch (e: Exception) {
            logger.error("è¯­è¨€åˆ‡æ¢å¤±è´¥", e)
        }
    }
}
```

### æ¡ä»¶æ€§æ¶ˆæ¯

```kotlin
class MyPlugin : BasePlugin() {
    
    private fun sendConditionalMessage(player: Player) {
        val playerLevel = getPlayerLevel(player)
        
        when {
            playerLevel >= 100 -> {
                messager.printf(player, "<%player.level.master%>", playerLevel)
            }
            playerLevel >= 50 -> {
                messager.printf(player, "<%player.level.expert%>", playerLevel)
            }
            playerLevel >= 10 -> {
                messager.printf(player, "<%player.level.intermediate%>", playerLevel)
            }
            else -> {
                messager.printf(player, "<%player.level.beginner%>", playerLevel)
            }
        }
    }
    
    private fun sendTimeBasedMessage(player: Player) {
        val hour = LocalTime.now().hour
        
        val timeKey = when (hour) {
            in 6..11 -> "time.morning"
            in 12..17 -> "time.afternoon"
            in 18..22 -> "time.evening"
            else -> "time.night"
        }
        
        messager.printf(player, "<%$timeKey%>", player.name)
    }
}
```

### å¤æ‚å‚æ•°å¤„ç†

```kotlin
class MyPlugin : BasePlugin() {
    
    private fun sendComplexMessage(player: Player) {
        val stats = getPlayerStats(player)
        
        // å¤šå‚æ•°æ¶ˆæ¯
        messager.printf(
            player,
            "<%player.stats.detailed%>",
            player.name,           // {0}
            stats.level,           // {1}
            stats.experience,      // {2}
            stats.playtime,        // {3}
            stats.achievements     // {4}
        )
        
        // æ ¼å¼åŒ–æ•°å­—
        val balance = getPlayerBalance(player)
        messager.printf(
            player,
            "<%player.balance.formatted%>",
            String.format("%.2f", balance)
        )
        
        // æ ¼å¼åŒ–æ—¶é—´
        val onlineTime = getOnlineTime(player)
        val formattedTime = formatDuration(onlineTime)
        messager.printf(
            player,
            "<%player.online_time%>",
            formattedTime
        )
    }
    
    private fun formatDuration(duration: Duration): String {
        val hours = duration.toHours()
        val minutes = duration.toMinutes() % 60
        return "${hours}å°æ—¶${minutes}åˆ†é’Ÿ"
    }
}
```

## ğŸ›¡ï¸ ç”Ÿå‘½å‘¨æœŸæœ€ä½³å®è·µ

### æ­£ç¡®çš„åˆå§‹åŒ–é¡ºåº

```kotlin
class MyPlugin : BasePlugin() {
    
    override fun onPluginEnable() {
        // âœ… ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åˆå§‹åŒ–ï¼ˆä½¿ç”¨è‹±æ–‡æ—¥å¿—ï¼‰
        logger.info("MyPlugin enabling...")
        
        // æ£€æŸ¥ä¾èµ–
        if (!checkDependencies()) {
            logger.error("Dependency check failed!")
            server.pluginManager.disablePlugin(this)
            return
        }
        
        // æ³¨å†Œä¸å¯é‡è½½åŠŸèƒ½
        registerCommands()
        registerEventListeners()
        
        // âœ… ç¬¬äºŒé˜¶æ®µï¼šè°ƒç”¨é‡è½½æ–¹æ³•ï¼ˆè®¾ç½®è¯­è¨€ç®¡ç†å™¨ï¼‰
        reloadPlugin()
        
        // âœ… ç¬¬ä¸‰é˜¶æ®µï¼šè¯­è¨€è®¾ç½®åå¯ä»¥ä½¿ç”¨ i18n æ¨¡æ¿
        logger.info("<%plugin.enabled%>")
    }
    
    override fun reloadPlugin() {
        try {
            // âœ… é‡è½½é˜¶æ®µï¼šè®¾ç½®è¯­è¨€ç®¡ç†å™¨
            logger.info("<%plugin.config.reloading%>")
            
            // 1. æ¸…ç†é…ç½®ç¼“å­˜
            configManager.clearCache()
            
            // 2. é‡æ–°è®¾ç½®è¯­è¨€ç®¡ç†å™¨
            setupLanguageManager(
                languageFiles = mapOf(
                    Locale.SIMPLIFIED_CHINESE to "lang/zh_CN.yml",
                    Locale.US to "lang/en_US.yml"
                ),
                majorLanguage = Locale.SIMPLIFIED_CHINESE,
                defaultLanguage = Locale.US
            )
            
            // 3. é‡è½½å­æ¨¡å—
            super.reloadPlugin()
            
            logger.info("<%plugin.config.reloaded%>")
            
        } catch (e: Exception) {
            logger.error("<%plugin.config.reload_failed%>", e)
            throw e
        }
    }
}
```

### é”™è¯¯å¤„ç†

```kotlin
class MyPlugin : BasePlugin() {
    
    override fun reloadPlugin() {
        try {
            setupLanguageManager(
                languageFiles = mapOf(
                    Locale.SIMPLIFIED_CHINESE to "lang/zh_CN.yml",
                    Locale.US to "lang/en_US.yml"
                ),
                majorLanguage = Locale.SIMPLIFIED_CHINESE,
                defaultLanguage = Locale.US
            )
        } catch (e: Exception) {
            logger.error("è¯­è¨€ç®¡ç†å™¨è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è¯­è¨€", e)
            
            // å›é€€åˆ°é»˜è®¤è¯­è¨€
            setupLanguageManager(
                languageFiles = mapOf(
                    Locale.US to "lang/en_US.yml"
                ),
                majorLanguage = Locale.US,
                defaultLanguage = Locale.US
            )
        }
    }
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è¯­è¨€æ–‡ä»¶ç»„ç»‡

```yaml
# âœ… æ¨èï¼šæŒ‰åŠŸèƒ½åˆ†ç»„
welcome:
  message: "æ¬¢è¿ {0}ï¼"
  first_time: "é¦–æ¬¡åŠ å…¥"

player:
  level_info: "ç­‰çº§ï¼š{0}"
  balance: "ä½™é¢ï¼š{0}"

error:
  no_permission: "æ— æƒé™"
  invalid_argument: "å‚æ•°é”™è¯¯ï¼š{0}"
```

### 2. æ¨¡æ¿å‘½åè§„èŒƒ

```kotlin
// âœ… æ¨èï¼šä½¿ç”¨æ¸…æ™°çš„æ¨¡æ¿åç§°
messager.printf(player, "<%welcome.message%>", player.name)
messager.printf(player, "<%error.no_permission%>")
messager.printf(player, "<%success.operation_completed%>")

// âŒ é¿å…ï¼šæ¨¡ç³Šçš„æ¨¡æ¿åç§°
messager.printf(player, "<%msg1%>", player.name)
messager.printf(player, "<%err%>")
```

### 3. å‚æ•°ä½¿ç”¨

```kotlin
// âœ… æ¨èï¼šæ˜ç¡®çš„å‚æ•°é¡ºåºå’Œå«ä¹‰
messager.printf(player, "<%player.stats%>", name, level, experience)

// åœ¨è¯­è¨€æ–‡ä»¶ä¸­æ³¨é‡Šå‚æ•°å«ä¹‰
# player.stats: "ç©å®¶ {0} ç­‰çº§ {1} ç»éªŒ {2}"
# {0} = ç©å®¶åç§°, {1} = ç­‰çº§, {2} = ç»éªŒå€¼
```

### 4. ç”Ÿå‘½å‘¨æœŸç®¡ç†

```kotlin
// âœ… æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸé¡ºåº
override fun onPluginEnable() {
    logger.info("Plugin enabling...")  // è‹±æ–‡æ—¥å¿—
    reloadPlugin()                     // è®¾ç½®è¯­è¨€ç®¡ç†å™¨
    logger.info("<%plugin.enabled%>") // i18n æ¨¡æ¿
}
```

---

**ç›¸å…³æ–‡æ¡£ï¼š** [ğŸ’¬ æ¶ˆæ¯ç³»ç»Ÿ](messaging.md) | [âš™ï¸ é…ç½®ç®¡ç†](configuration.md) | [ğŸ”„ ç”Ÿå‘½å‘¨æœŸç®¡ç†](lifecycle.md)
