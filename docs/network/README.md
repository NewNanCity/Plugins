# Network æ¨¡å—ç”¨æˆ·æ•™ç¨‹

æ¬¢è¿ä½¿ç”¨ç°ä»£åŒ–çš„ HTTP å®¢æˆ·ç«¯æ¡†æ¶ï¼æœ¬æ•™ç¨‹å°†å¸¦æ‚¨ä»é›¶å¼€å§‹å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Network æ¨¡å—æ„å»ºå¼ºå¤§çš„ç½‘ç»œåº”ç”¨ã€‚

## ğŸ“š æ–‡æ¡£ç›®å½•

### åŸºç¡€æ•™ç¨‹
- [ğŸ“– ä»‹ç»](intro.md) - 5åˆ†é’Ÿå¿«é€Ÿäº†è§£Networkæ¨¡å—
- [ğŸš€ å¿«é€Ÿå¼€å§‹](quick-start.md) - ç¬¬ä¸€ä¸ªHTTPè¯·æ±‚
- [ğŸ¯ åŸºç¡€æ¦‚å¿µ](concepts.md) - æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### åŠŸèƒ½æŒ‡å—
- [ğŸŒ HTTPå®¢æˆ·ç«¯](http-client.md) - åŸºç¡€HTTPè¯·æ±‚å’Œå“åº”
- [ğŸ”§ ç±»å‹å®‰å…¨](type-safety.md) - ç±»å‹å®‰å…¨çš„è¯·æ±‚å’Œåºåˆ—åŒ–
- [ğŸ” è®¤è¯æ”¯æŒ](authentication.md) - Basicã€Bearerã€API Keyè®¤è¯
- [âš¡ æ‰¹é‡è¯·æ±‚](batch-requests.md) - é«˜æ•ˆçš„æ‰¹é‡è¯·æ±‚å¤„ç†
- [ğŸ“ æ–‡ä»¶æ“ä½œ](file-operations.md) - æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
- [ğŸ”„ é‡è¯•æœºåˆ¶](retry-mechanism.md) - æ™ºèƒ½è¯·æ±‚é‡è¯•

### é«˜çº§ä¸»é¢˜
- [â™»ï¸ å¯ç»ˆæ­¢è¯·æ±‚](terminable-requests.md) - ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œèµ„æºæ¸…ç†
- [ğŸ“Š ç½‘ç»œç›‘æ§](network-monitoring.md) - è¿æ¥çŠ¶æ€ç›‘æ§å’Œå»¶è¿Ÿæµ‹é‡
- [ğŸ—ï¸ æ¶æ„è®¾è®¡](architecture.md) - æ¨¡å—æ¶æ„å’Œè®¾è®¡æ¨¡å¼
- [âš™ï¸ æ€§èƒ½ä¼˜åŒ–](performance.md) - æ€§èƒ½è°ƒä¼˜å’Œæœ€ä½³å®è·µ

### å‚è€ƒèµ„æ–™
- [ğŸ“‹ APIå‚è€ƒ](api-reference.md) - å®Œæ•´APIæ–‡æ¡£
- [ğŸ’¡ æœ€ä½³å®è·µ](best-practices.md) - å¼€å‘å»ºè®®å’Œæ¨¡å¼
- [ğŸ”§ æ•…éšœæ’é™¤](troubleshooting.md) - å¸¸è§é—®é¢˜è§£å†³
- [ğŸ“ ç¤ºä¾‹ä»£ç ](examples.md) - å®Œæ•´ç¤ºä¾‹é›†åˆ

## ğŸ¯ å¿«é€Ÿå¯¼èˆª

### æˆ‘æƒ³è¦...
- **å‘é€ç¬¬ä¸€ä¸ªHTTPè¯·æ±‚** â†’ [å¿«é€Ÿå¼€å§‹](quick-start.md)
- **åˆ›å»ºHTTPå®¢æˆ·ç«¯** â†’ [HTTPå®¢æˆ·ç«¯](http-client.md)
- **ç±»å‹å®‰å…¨çš„è¯·æ±‚** â†’ [ç±»å‹å®‰å…¨](type-safety.md)
- **æ·»åŠ è®¤è¯** â†’ [è®¤è¯æ”¯æŒ](authentication.md)
- **æ‰¹é‡å¤„ç†è¯·æ±‚** â†’ [æ‰¹é‡è¯·æ±‚](batch-requests.md)
- **ä¸‹è½½æ–‡ä»¶** â†’ [æ–‡ä»¶æ“ä½œ](file-operations.md)
- **å¤„ç†å¤±è´¥é‡è¯•** â†’ [é‡è¯•æœºåˆ¶](retry-mechanism.md)
- **ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ** â†’ [å¯ç»ˆæ­¢è¯·æ±‚](terminable-requests.md)
- **ç›‘æ§ç½‘ç»œçŠ¶æ€** â†’ [ç½‘ç»œç›‘æ§](network-monitoring.md)
- **è§£å†³é—®é¢˜** â†’ [æ•…éšœæ’é™¤](troubleshooting.md)

## ğŸ†• æœ€æ–°ç‰¹æ€§

- **å¼‚æ­¥æ”¯æŒ** - åŸºäºä»»åŠ¡è°ƒåº¦å™¨ï¼Œæ”¯æŒå¼‚æ­¥éé˜»å¡æ“ä½œ
- **ç±»å‹å®‰å…¨** - æä¾›ç±»å‹å®‰å…¨çš„DSLå’Œæ‰©å±•å‡½æ•°
- **æ’ä»¶åŒ–** - æ”¯æŒæ—¥å¿—ã€åºåˆ—åŒ–ã€è®¤è¯ç­‰æ’ä»¶
- **å¤šå¼•æ“** - æ”¯æŒOkHttpã€Javaã€Apacheç­‰å¤šç§HTTPå¼•æ“
- **åºåˆ—åŒ–** - æ”¯æŒkotlinx.serializationå’ŒJackson
- **è®¤è¯** - æ”¯æŒBasicã€Bearerã€API Keyç­‰è®¤è¯æ–¹å¼
- **ç”Ÿå‘½å‘¨æœŸ** - è‡ªåŠ¨é›†æˆåˆ°BasePluginç”Ÿå‘½å‘¨æœŸç®¡ç†
- **å¯ç»ˆæ­¢** - æ”¯æŒTerminableConsumerï¼Œè‡ªåŠ¨ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ
- **ç›‘æ§** - æä¾›ç½‘ç»œçŠ¶æ€ç›‘æ§å’Œå»¶è¿Ÿæµ‹é‡
- **é‡è¯•** - å†…ç½®è¯·æ±‚é‡è¯•æœºåˆ¶
- **æ‰¹é‡** - æ”¯æŒæ‰¹é‡è¯·æ±‚å¤„ç†

## ğŸ”§ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- **Ktor Client Core** - æ ¸å¿ƒHTTPå®¢æˆ·ç«¯
- **Ktor Client OkHttp** - OkHttpå¼•æ“ï¼ˆé»˜è®¤ï¼‰
- **Ktor Client Content Negotiation** - å†…å®¹åå•†
- **Ktor Client Logging** - è¯·æ±‚æ—¥å¿—
- **Ktor Client Auth** - è®¤è¯æ”¯æŒ

### åºåˆ—åŒ–æ”¯æŒ
- **kotlinx.serialization** - KotlinåŸç”Ÿåºåˆ—åŒ–
- **Jackson** - å…¼å®¹Configæ¨¡å—çš„Jacksonåºåˆ—åŒ–

### ç‰ˆæœ¬è¦æ±‚
- **Kotlin** 2.2.0+
- **Java** 17+
- **Ktor** 2.3.12+

## ğŸš€ å¿«é€Ÿé¢„è§ˆ

### å¼‚æ­¥è°ƒåº¦æ–¹å¼ï¼ˆæ¨èï¼‰
```kotlin
class MyPlugin : BasePlugin() {
    override fun onPluginEnable() {
        // ä½¿ç”¨æ’ä»¶å¼‚æ­¥è°ƒåº¦å™¨è¿›è¡Œç½‘ç»œè¯·æ±‚
        runAsync {
            try {
                // GETè¯·æ±‚
                val response = httpGet("https://api.example.com/data") {
                    header("Authorization", "Bearer token")
                    parameter("limit", "10")
                }

                // åœ¨ä¸»çº¿ç¨‹å¤„ç†å“åº”
                runSync {
                    logger.info("å“åº”çŠ¶æ€: ${response.status}")
                }

                // POSTè¯·æ±‚
                val postResponse = httpPost("https://api.example.com/users") {
                    contentType(ContentType.Application.Json)
                    setBody("""{"name": "John", "age": 30}""")
                }

                // ç±»å‹å®‰å…¨çš„è¯·æ±‚
                val user: User = httpGetTyped("https://api.example.com/users/1")

                runSync {
                    logger.info("ç”¨æˆ·å: ${user.name}")
                }
            } catch (e: Exception) {
                runSync {
                    logger.error("ç½‘ç»œè¯·æ±‚å¤±è´¥", e)
                }
            }
        }
    }
}
```

### ä»»åŠ¡é“¾æ–¹å¼
```kotlin
class TaskChainPlugin : BasePlugin() {
    override fun onPluginEnable() {
        // ä½¿ç”¨ä»»åŠ¡é“¾è¿›è¡Œç½‘ç»œæ“ä½œ
        val networkTask = runAsync {
            // ä½¿ç”¨é»˜è®¤HTTPå®¢æˆ·ç«¯
            val client = getHttpClient()
            client.get("https://api.example.com/data")
        }

        networkTask.thenRunSync { response ->
            logger.info("å“åº”çŠ¶æ€: ${response.status}")

            // è‡ªå®šä¹‰å®¢æˆ·ç«¯é…ç½®
            val customClient = createHttpClient("custom") {
                timeout(60000)
                retries(5)
                userAgent("MyPlugin/1.0")
            }
        }
    }
}
```

### è®¤è¯æ”¯æŒ
```kotlin
override fun onPluginEnable() {
    // ä½¿ç”¨å¼‚æ­¥è°ƒåº¦å™¨è¿›è¡Œè®¤è¯è¯·æ±‚
    runAsync {
        try {
            // API Keyè®¤è¯
            val apiClient = createApiKeyHttpClient("github", "ghp_xxxxxxxxxxxx")
            val repos = apiClient.getTyped<List<Repository>>("https://api.github.com/user/repos")

            // Bearer Tokenè®¤è¯
            val oauthClient = createBearerHttpClient("oauth", "access_token_here")
            val profile = oauthClient.getTyped<UserProfile>("https://api.example.com/profile")

            // Basicè®¤è¯
            val basicClient = createBasicAuthHttpClient("basic", "username", "password")
            val data = basicClient.getTyped<ApiData>("https://api.example.com/protected")

            // å¤„ç†è®¤è¯åçš„æ•°æ®
            runSync {
                processAuthenticatedData(repos, profile, data)
            }
        } catch (e: Exception) {
            runSync {
                logger.error("è®¤è¯è¯·æ±‚å¤±è´¥", e)
            }
        }
    }
        }
    }
}
```

### æ‰¹é‡è¯·æ±‚
```kotlin
override fun onPluginEnable() {
    // ä½¿ç”¨å¼‚æ­¥è°ƒåº¦å™¨è¿›è¡Œæ‰¹é‡è¯·æ±‚
    runAsync {
        try {
            // æ‰¹é‡è¯·æ±‚
            val client = getHttpClient()
            val responses = mutableListOf<Any>()

            // å¹¶è¡Œæ‰§è¡Œå¤šä¸ªè¯·æ±‚
            val usersTask = runAsync { client.get("https://api.example.com/users") }
            val postsTask = runAsync { client.get("https://api.example.com/posts") }
            val analyticsTask = runAsync {
                client.post("https://api.example.com/analytics") {
                    setBody("""{"event": "page_view"}""")
                }
            }

            // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
            responses.add(usersTask.get())
            responses.add(postsTask.get())
            responses.add(analyticsTask.get())

            // æ‰¹é‡ç”¨æˆ·è¯·æ±‚å¤„ç†
            val userTasks = listOf(
                runAsync { client.getTyped<User>("https://api.example.com/users/1") },
                runAsync { client.getTyped<User>("https://api.example.com/users/2") },
                runAsync { client.getTyped<User>("https://api.example.com/users/3") }
            )

            val users = userTasks.map { it.get() }

            // åœ¨ä¸»çº¿ç¨‹å¤„ç†ç»“æœ
            runSync {
                processBatchResults(responses, users)
            }
        } catch (e: Exception) {
            runSync {
                logger.error("æ‰¹é‡è¯·æ±‚å¤±è´¥", e)
            }
        }
    }

            batchHttpRequests(requests) { users ->
                logger.info("è·å–åˆ° ${users.size} ä¸ªç”¨æˆ·")
            }
        }
    }
}
```

### ç½‘ç»œç›‘æ§
```kotlin
override fun onPluginEnable() {
    // ä½¿ç”¨é‡å¤ä»»åŠ¡è¿›è¡Œç½‘ç»œç›‘æ§
    runSyncRepeating(0L, 600L) { task -> // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
        runAsync {
            try {
                // ç›‘æ§å¤šä¸ªæœåŠ¡
                val healthTask = runAsync {
                    httpGet("https://api.example.com/health")
                }
                val pingTask = runAsync {
                    httpGet("https://cdn.example.com/ping")
                }

                val healthResponse = healthTask.get()
                val pingResponse = pingTask.get()

                runSync {
                    // å¤„ç†ç›‘æ§ç»“æœ
                    if (healthResponse.status.value in 200..299) {
                        logger.info("APIæœåŠ¡å¯ç”¨")
                    } else {
                        logger.warning("APIæœåŠ¡ä¸å¯ç”¨: ${healthResponse.status}")
                    }

                    if (pingResponse.status.value in 200..299) {
                        logger.info("CDNæœåŠ¡å¯ç”¨")
                    } else {
                        logger.warning("CDNæœåŠ¡ä¸å¯ç”¨: ${pingResponse.status}")
                    }
                }
            } catch (e: Exception) {
                runSync {
                    logger.error("ç½‘ç»œç›‘æ§æ£€æŸ¥å¤±è´¥", e)
                }
            }
        }
    }

    // å»¶è¿Ÿæµ‹é‡ä»»åŠ¡
    runAsync {
        try {
            val latency = measureNetworkLatency("https://api.example.com/ping", 5)
            runSync {
                logger.info("""
                    ç½‘ç»œå»¶è¿Ÿç»Ÿè®¡:
                    - å¹³å‡: ${latency.average}ms
                    - æœ€å°: ${latency.min}ms
                    - æœ€å¤§: ${latency.max}ms
                    - æˆåŠŸç‡: ${latency.successRate * 100}%
                """.trimIndent())
            }
        } catch (e: Exception) {
            runSync {
                logger.error("å»¶è¿Ÿæµ‹é‡å¤±è´¥", e)
            }
        }
    }
}
```

### å¯å–æ¶ˆçš„ä»»åŠ¡è¯·æ±‚
```kotlin
class ApiService : BasePlugin() {
    private val activeTasks = mutableListOf<ITaskHandler<*>>()

    fun fetchUserData(userId: Int) {
        // åˆ›å»ºå¯å–æ¶ˆçš„HTTPè¯·æ±‚ä»»åŠ¡
        val userTask = runAsync {
            httpGetTyped<User>("https://api.example.com/users/$userId")
        }

        // ä¿å­˜ä»»åŠ¡å¼•ç”¨
        activeTasks.add(userTask)

        // å¤„ç†ç»“æœ
        userTask.thenRunSync { user ->
            "https://api.example.com/users/$userId",
            scope
        ) { result ->
            result.onSuccess { user ->
                println("è·å–ç”¨æˆ·æˆåŠŸ: ${user.name}")
            }.onFailure { error ->
                println("è·å–ç”¨æˆ·å¤±è´¥: ${error.message}")
            }
        }
    }

    override fun <T : AutoCloseable> bind(terminable: T): T {
        return terminableRegistry.bind(terminable)
    }

    fun close() {
        scope.cancel()
        terminableRegistry.close()
    }
}
```

### æ–‡ä»¶ä¸‹è½½
```kotlin
override fun onPluginEnable() {
    // ä½¿ç”¨å¼‚æ­¥è°ƒåº¦å™¨è¿›è¡Œæ–‡ä»¶ä¸‹è½½
    runAsync {
        try {
            // æ–‡ä»¶ä¸‹è½½
            val data = downloadFile(
                url = "https://example.com/large-file.zip",
                maxSize = 50 * 1024 * 1024 // 50MB
            )

            // ä¿å­˜æ–‡ä»¶
            File("downloads/file.zip").writeBytes(data)

            runSync {
                logger.info("æ–‡ä»¶ä¸‹è½½å®Œæˆ: ${data.size} bytes")
            }
        } catch (error: Exception) {
            runSync {
                logger.warning("æ–‡ä»¶ä¸‹è½½å¤±è´¥: ${error.message}")
            }
        }
    }

    // å¯å–æ¶ˆçš„æ–‡ä»¶ä¸‹è½½ä»»åŠ¡
    val downloadTask = runAsync {
        try {
            val data = downloadFile(
                url = "https://example.com/file.zip",
                maxSize = 50 * 1024 * 1024
            )

            runSync {
                logger.info("ä¸‹è½½å®Œæˆ: ${data.size} bytes")
            }
        } catch (error: Exception) {
            runSync {
                logger.info("ä¸‹è½½å¤±è´¥: ${error.message}")
            }
        }
    }

    // ä¿å­˜ä»»åŠ¡å¼•ç”¨ä»¥ä¾¿åç»­å–æ¶ˆ
    bind(downloadTask)
        }
    }
}
```

## ğŸ¤ è´¡çŒ®

å¦‚æœæ‚¨å‘ç°æ–‡æ¡£ä¸­çš„é”™è¯¯æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æäº¤Issueæˆ–Pull Requestã€‚

---

**å¼€å§‹æ‚¨çš„Networkå¼€å‘ä¹‹æ—…** â†’ [ğŸ“– ä»‹ç»](intro.md)
